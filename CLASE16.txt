
----------------------------------------------

SELECT --------------

FROM ------------------

[WHERE --------------------]

[CONNECT BY -----------

         STAR WITH ----------]

[GROUP BY  ----------

       [HAVING ---------]]

[ORDER BY ---------];

------------------------





SELECT * FROM EMPLE FOR UPDATE;



-- TODA LA JERARQUÍA DE LA EMPRESA;

SELECT APELLIDO,EMP_NO,DIR,LEVEL

  FROM EMPLE

  CONNECT BY  PRIOR EMP_NO=DIR

  START WITH APELLIDO='REY';

  

  

 --COLOCACON DE LA JERARQUÍA

 

SELECT LPAD(APELLIDO,LENGTH(APELLIDO)+ 6*LEVEL), OFICIO AS TRABAJADORES ,LEVEL

  FROM EMPLE

  CONNECT BY  PRIOR EMP_NO=DIR

  START WITH APELLIDO='REY'; 

   

  

  

 --TODOS LOS QUE DEPENDEN DE JIMENEZ;

 

SELECT LPAD(APELLIDO,LENGTH(APELLIDO)+ 6*LEVEL),DIR,LEVEL

  FROM EMPLE

  --wherE apellido <> 'JIMÉNEZ'

  CONNECT BY  PRIOR EMP_NO=DIR

  START WITH APELLIDO='JIMÉNEZ';



--- TODOS LOS JEFES DE ALONSO

SELECT LPAD(APELLIDO,LENGTH(APELLIDO)+ 12/LEVEL),EMP_NO,DIR,LEVEL

  FROM EMPLE

  WHERE  APELLIDO <> 'ALONSO'

  CONNECT BY EMP_NO=PRIOR DIR

  START WITH APELLIDO='ALONSO';



  

--- CUANTOS ESCALAFONES HAY



SELECT MAX(LEVEL)

FROM EMPLE

CONNECT BY PRIOR EMP_NO=DIR

START WITH APELLIDO='REY';  

-- TAMBIEN



SELECT MAX(LEVEL)

FROM EMPLE

CONNECT BY EMP_NO=PRIOR DIR

START WITH APELLIDO='ALONSO'; 



-- TAMBIEN

SELECT COUNT(DISTINCT LEVEL)

  FROM EMPLE

  CONNECT BY PRIOR EMP_NO=DIR

  START WITH APELLIDO='REY';  

  

--ESCALAFONES INFERIORES A CEREZO



SELECT COUNT(DISTINCT LEVEL)-1

  FROM EMPLE

  CONNECT BY PRIOR EMP_NO=DIR

  START WITH APELLIDO='CEREZO';  



  

---CUANTOS HAY DE CADA ESCALAFON 

 

SELECT LEVEL,COUNT(*)

FROM EMPLE

CONNECT BY PRIOR EMP_NO=DIR

START WITH APELLIDO='REY'

GROUP BY LEVEL;  



--SUMA DE SALARIOS DE CADA ESCALAFON



SELECT LEVEL AS ESCALAFON, SUM(SALARIO)

FROM EMPLE

CONNECT BY PRIOR EMP_NO = DIR

START WITH APELLIDO='REY'

GROUP BY LEVEL;


--CUANTOS HAY CON COMISIONES NULAS EN CADA ESCALAFON


SELECT LEVEL AS ESCALAFON, COUNT(COMISION)

FROM EMPLE

CONNECT BY PRIOR EMP_NO = DIR

START WITH APELLIDO='REY'

GROUP BY LEVEL;


--SUMA DE SALARIOS DE ANALISTAS DE CADA ESCALAFON


SELECT LEVEL AS ESCALAFON, TO_CHAR(SUM(SALARIO),'999G999G999G999') AS "SALARIO ANALISTAS"

FROM EMPLE

WHERE OFICIO = 'ANALISTA'

CONNECT BY PRIOR EMP_NO = DIR

START WITH APELLIDO='REY'

GROUP BY LEVEL;



--SUMA DE SALARIOS Y TOTAL TRABAJADORES DE OFICIO EMPLEADO POR ESCALAFON



SELECT LEVEL AS ESCALAFON, SUM(SALARIO) AS "SALARIO EMPLEADOS" , COUNT(*) TRABAJADORES

FROM EMPLE

WHERE OFICIO = 'EMPLEADO'

CONNECT BY PRIOR EMP_NO = DIR

START WITH APELLIDO='REY'

GROUP BY LEVEL;



--TOTAL TRABAJADORES POR ESCALAFON Y DENTRO DE CADA ESCALAFON POR OFICIOS
--ORDENADO POR ESCALAFÓN


SELECT LEVEL AS ESCALAFON, OFICIO, COUNT(*)
FROM EMPLE
CONNECT BY PRIOR EMP_NO = DIR
START WITH APELLIDO='REY'
GROUP BY LEVEL,OFICIO
ORDER BY ESCALAFON;


--TOTAL TRABAJADORES POR ESCALAFON Y DENTRO DE CADA ESCALAFON POR DEPARTAMENTO

SELECT LEVEL AS ESCALAFON, DEPT_NO, COUNT(*)

FROM EMPLE

CONNECT BY PRIOR EMP_NO = DIR

START WITH APELLIDO='REY'

GROUP BY LEVEL,DEPT_NO
ORDER BY ESCALAFON;



--NUMERO DE TRABJADORES,ESCALAFON Y OFICIO DEL ESCALAFON CON MAS TRABAJADORES DE OFICIO EMPLEADO



SELECT COUNT(*),LEVEL,OFICIO
 FROM EMPLE
 WHERE OFICIO = 'EMPLEADO'
 CONNECT BY PRIOR EMP_NO = DIR
 START WITH APELLIDO = 'REY'
 GROUP BY LEVEL,OFICIO
   HAVING COUNT(*) = (  SELECT MAX(COUNT(*))
                        FROM EMPLE
                        WHERE OFICIO = 'EMPLEADO'
                        CONNECT BY PRIOR EMP_NO = DIR
                        START WITH APELLIDO = 'REY'
                        GROUP BY LEVEL,OFICIO
                        );

                        

--NUMERO DE TRABAJADORES, 
--ESCALAFON Y OFICIO DE LOS  TRABAJADORES DEL ESCALAFON 
-- CON MAS TRABAJADORES POR ESCALAFON DE CADA OFICIO

CASE [EXP]
   WHEN VALOR THEN VALORNÑUEVO
   WHEN VALOR2 THEN VALOR2NUEVO
     ELSE
       VALOR POR DEFECTO
 END 

DECODE (EXP,V1,NUEVO1,
            V2,NUEVO2,
            --------
            DEFECTO
            )                        
         

SELECT LEVEL AS ESCALAFON ,OFICIO,COUNT(*)
 FROM EMPLE
 CONNECT BY PRIOR EMP_NO = DIR
 START WITH APELLIDO = 'REY'
 GROUP BY LEVEL,OFICIO
   HAVING COUNT(*) = (  SELECT MAX(COUNT(*))
                        FROM EMPLE
                        CONNECT BY PRIOR EMP_NO = DIR
                        START WITH APELLIDO = 'REY'
                        GROUP BY LEVEL,OFICIO

                        );


--SACAR LA CODIFICIACION Y EL TOTAL DE EMPLEADOS DE CADA CATEGORIA


SELECT CASE LEVEL
       WHEN 1 THEN 'EN LA CÚSPIDE'
       WHEN 2 THEN 'UN PELO Y LLEGAS'
       WHEN 3 THEN 'PROGRESANDO'
       WHEN 4 THEN 'CASTA PARIA'
            ELSE 'NO COMPUTADO'
       END AS CATEGORIA,
       LEVEL, 
       COUNT(*)
FROM EMPLE
CONNECT BY PRIOR EMP_NO = DIR
START WITH APELLIDO='REY' 
GROUP BY LEVEL
ORDER BY LEVEL;        



SELECT DECODE(LEVEL,1,'EN LA CUSPIDE',
                   2,'UN PELO Y LLEGAS',
                   3,'PROGRESANDO',
                   4,'CASTA PARIA'
                   ,' NO SE'
                   ) AS CATEGORIA, LEVEL, COUNT(*)

FROM EMPLE
CONNECT BY PRIOR EMP_NO = DIR
START WITH APELLIDO='REY' 
GROUP BY LEVEL
ORDER BY LEVEL;        





-- CATALOGA EL NUMERO DE EMPLEADOS MENOS DE 3 POCOS, 
-- TRES ACEPTABLE, MENOS DE 7 MUCHOS OTRO CASO MULTITUD



SELECT CASE 
       WHEN count(*) < 3 THEN 'POCOS'
       WHEN COUNT(*) = 3 THEN 'ACEPTABLE'
       WHEN COUNT(*) < 7 THEN 'MUCHOS'    
       ELSE 'MULTITUD'
       END AS CATEGORIA,COUNT(*)
FROM EMPLE
CONNECT BY PRIOR EMP_NO = DIR
START WITH APELLIDO='REY' 
GROUP BY LEVEL
ORDER BY LEVEL;  
